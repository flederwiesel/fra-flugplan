<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>getflights &middot; debug output</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="author" content="Tobias Kühne">
</head>
<body>
<pre>
arrival
http://localhost/.../flugplan/airportcity?type=arrival&typ=p&context=0&sprache=de&items=3&init=true&page=1
http://localhost/.../flugplan/airportcity?type=arrival&typ=p&context=0&sprache=de&items=3&usepager=true&page=2
http://localhost/.../flugplan/airportcity?type=arrival&typ=p&context=0&sprache=de&items=3&usepager=true&page=3
http://localhost/.../flugplan/airportcity?type=arrival&typ=p&context=0&sprache=de&items=3&usepager=true&page=4
http://localhost/.../flugplan/airportcity?type=arrival&typ=p&context=0&sprache=de&items=3&usepager=true&page=5
SELECT `id` FROM `airlines` WHERE `code`='SA';
=99
SELECT `id` FROM `airlines` WHERE `code`='SA';
=99
SELECT `id` FROM `models` WHERE `icao`='A346';
=19
SELECT `id` FROM `aircrafts` WHERE `reg`='ZS-SNC';
=10
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='arrival' AND `airline`=99 AND `code`='260' AND `scheduled`='0000-00-01 06:15'
=25,10
UPDATE `flights` SET `expected`='0000-00-01 05:18', `aircraft`=10, `model`=19 WHERE `id`=25;
=OK
SELECT `num`, `current`, `previous` FROM `visits` WHERE `aircraft`=10;
=1,0000-00-01 06:15:00,NULL

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='CX';
=24
SELECT `id` FROM `airlines` WHERE `code`='CX';
=24
SELECT `id` FROM `models` WHERE `icao`='B77W';
=68
SELECT `id` FROM `aircrafts` WHERE `reg`='B-KPF';
=11
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='arrival' AND `airline`=24 AND `code`='289' AND `scheduled`='0000-00-01 06:20'
=26,11
UPDATE `flights` SET `aircraft`=11, `model`=68 WHERE `id`=26;
=OK
SELECT `num`, `current`, `previous` FROM `visits` WHERE `aircraft`=11;
=1,0000-00-01 06:20:00,NULL

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='AC';
=4
SELECT `id` FROM `airlines` WHERE `code`='AC';
=4
SELECT `id` FROM `models` WHERE `icao`='A333';
=14
SELECT `id` FROM `aircrafts` WHERE `reg`='C-GHLM';
=5
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='arrival' AND `airline`=4 AND `code`='874' AND `scheduled`='0000-00-01 07:00'
=28,5
UPDATE `flights` SET `expected`='0000-00-01 07:00', `aircraft`=5, `model`=14 WHERE `id`=28;
=OK
SELECT `num`, `current`, `previous` FROM `visits` WHERE `aircraft`=5;
=2,0000-00-01 07:00:00,0000-00-00 11:15:00

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='UA';
=120
SELECT `id` FROM `airlines` WHERE `code`='UA';
=120
SELECT `id` FROM `models` WHERE `icao`='B744';
=57
SELECT `id` FROM `aircrafts` WHERE `reg`='N116UA';
=4
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='arrival' AND `airline`=120 AND `code`='903' AND `scheduled`='0000-00-01 09:45'
=29,4
UPDATE `flights` SET `aircraft`=4, `model`=57 WHERE `id`=29;
=OK
SELECT `num`, `current`, `previous` FROM `visits` WHERE `aircraft`=4;
=2,0000-00-01 09:45:00,0000-00-00 09:45:00

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='TK';
=112
SELECT `id` FROM `airlines` WHERE `code`='TK';
=112
SELECT `id` FROM `models` WHERE `icao`='A343';
=17
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='arrival' AND `airline`=112 AND `code`='1587' AND `scheduled`='0000-00-01 10:40'
=30,
UPDATE `flights` SET `aircraft`=NULL, `model`=17 WHERE `id`=30;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='AC';
=4
SELECT `id` FROM `airlines` WHERE `code`='AC';
=4
SELECT `id` FROM `models` WHERE `icao`='A333';
=14
SELECT `id` FROM `aircrafts` WHERE `reg`='C-GFAH';
=3
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='arrival' AND `airline`=4 AND `code`='844' AND `scheduled`='0000-00-01 11:15'
=32,3
UPDATE `flights` SET `aircraft`=3, `model`=14 WHERE `id`=32;
=OK
SELECT `num`, `current`, `previous` FROM `visits` WHERE `aircraft`=3;
=2,0000-00-01 11:15:00,0000-00-00 07:00:00

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='AC';
=4
SELECT `id` FROM `airlines` WHERE `code`='AC';
=4
SELECT `id` FROM `models` WHERE `icao`='A333';
=14
SELECT `id` FROM `aircrafts` WHERE `reg`='C-GHKW';
=6
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='arrival' AND `airline`=4 AND `code`='876' AND `scheduled`='0000-00-01 11:45'
=33,6
UPDATE `flights` SET `aircraft`=6, `model`=14 WHERE `id`=33;
=OK
SELECT `num`, `current`, `previous` FROM `visits` WHERE `aircraft`=6;
=2,0000-00-01 11:45:00,0000-00-00 11:45:00

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='TP';
=113
SELECT `id` FROM `airlines` WHERE `code`='TP';
=113
SELECT `id` FROM `models` WHERE `icao`='A320';
=9
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='arrival' AND `airline`=113 AND `code`='572' AND `scheduled`='0000-00-01 12:35'
=35,
UPDATE `flights` SET `aircraft`=NULL, `model`=9 WHERE `id`=35;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='KU';
=63
SELECT `id` FROM `airlines` WHERE `code`='KU';
=63
SELECT `id` FROM `models` WHERE `icao`='A306';
=4
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='arrival' AND `airline`=63 AND `code`='171' AND `scheduled`='0000-00-01 13:20'
=38,
UPDATE `flights` SET `aircraft`=NULL, `model`=4 WHERE `id`=38;
=OK

/************************************/


/************************************/

SELECT `id` FROM `airlines` WHERE `code`='TP';
=113
SELECT `id` FROM `airlines` WHERE `code`='TP';
=113
SELECT `id` FROM `models` WHERE `icao`='A320';
=9
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='arrival' AND `airline`=113 AND `code`='576' AND `scheduled`='0000-00-01 18:25'
=43,
UPDATE `flights` SET `aircraft`=NULL, `model`=9 WHERE `id`=43;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='SQ';
=105
SELECT `id` FROM `airlines` WHERE `code`='SQ';
=105
SELECT `id` FROM `models` WHERE `icao`='B77W';
=68
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='arrival' AND `airline`=105 AND `code`='326' AND `scheduled`='0000-00-01 20:30'
=45,
UPDATE `flights` SET `aircraft`=NULL, `model`=68 WHERE `id`=45;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='TP';
=113
SELECT `id` FROM `airlines` WHERE `code`='TP';
=113
SELECT `id` FROM `models` WHERE `icao`='A320';
=9
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='arrival' AND `airline`=113 AND `code`='578' AND `scheduled`='0000-00-01 22:30'
=48,
UPDATE `flights` SET `aircraft`=NULL, `model`=9 WHERE `id`=48;
=OK

/************************************/

---------------------------
12 Flüge gefunden.
    Dauer: 0.000s

===========================

departure
http://localhost/.../flugplan/airportcity?type=departure&typ=p&context=0&sprache=de&items=3&init=true&page=1
http://localhost/.../flugplan/airportcity?type=departure&typ=p&context=0&sprache=de&items=3&usepager=true&page=2
http://localhost/.../flugplan/airportcity?type=departure&typ=p&context=0&sprache=de&items=3&usepager=true&page=3
http://localhost/.../flugplan/airportcity?type=departure&typ=p&context=0&sprache=de&items=3&usepager=true&page=4
http://localhost/.../flugplan/airportcity?type=departure&typ=p&context=0&sprache=de&items=3&usepager=true&page=5
SELECT `id` FROM `airlines` WHERE `code`='TP';
=113
SELECT `id` FROM `airlines` WHERE `code`='TP';
=113
SELECT `id` FROM `models` WHERE `icao`='A320';
=9
SELECT `id` FROM `aircrafts` WHERE `reg`='CS-TNP';
=7
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='departure' AND `airline`=113 AND `code`='571' AND `scheduled`='0000-00-01 06:20'
=27,7
UPDATE `flights` SET `aircraft`=7, `model`=9 WHERE `id`=27;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='AC';
=4
SELECT `id` FROM `airlines` WHERE `code`='AC';
=4
SELECT `id` FROM `models` WHERE `icao`='A333';
=14
SELECT `id` FROM `aircrafts` WHERE `reg`='C-GHLM';
=5
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='departure' AND `airline`=4 AND `code`='845' AND `scheduled`='0000-00-01 10:30'
=31,5
UPDATE `flights` SET `aircraft`=5, `model`=14 WHERE `id`=31;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='TK';
=112
SELECT `id` FROM `airlines` WHERE `code`='TK';
=112
SELECT `id` FROM `models` WHERE `icao`='A343';
=17
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='departure' AND `airline`=112 AND `code`='1588' AND `scheduled`='0000-00-01 11:45'
=34,
UPDATE `flights` SET `aircraft`=NULL, `model`=17 WHERE `id`=34;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='UA';
=120
SELECT `id` FROM `airlines` WHERE `code`='UA';
=120
SELECT `id` FROM `models` WHERE `icao`='B744';
=57
SELECT `id` FROM `aircrafts` WHERE `reg`='N116UA';
=4
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='departure' AND `airline`=120 AND `code`='902' AND `scheduled`='0000-00-01 12:15'
=36,4
UPDATE `flights` SET `aircraft`=4, `model`=57 WHERE `id`=36;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='CX';
=24
SELECT `id` FROM `airlines` WHERE `code`='CX';
=24
SELECT `id` FROM `models` WHERE `icao`='B77W';
=68
SELECT `id` FROM `aircrafts` WHERE `reg`='B-KPF';
=11
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='departure' AND `airline`=24 AND `code`='288' AND `scheduled`='0000-00-01 12:55'
=37,11
UPDATE `flights` SET `aircraft`=11, `model`=68 WHERE `id`=37;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='TP';
=113
SELECT `id` FROM `airlines` WHERE `code`='TP';
=113
SELECT `id` FROM `models` WHERE `icao`='A320';
=9
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='departure' AND `airline`=113 AND `code`='573' AND `scheduled`='0000-00-01 13:20'
=39,
UPDATE `flights` SET `aircraft`=NULL, `model`=9 WHERE `id`=39;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='AC';
=4
SELECT `id` FROM `airlines` WHERE `code`='AC';
=4
SELECT `id` FROM `models` WHERE `icao`='A333';
=14
SELECT `id` FROM `aircrafts` WHERE `reg`='C-GFAH';
=3
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='departure' AND `airline`=4 AND `code`='875' AND `scheduled`='0000-00-01 13:30'
=40,3
UPDATE `flights` SET `aircraft`=3, `model`=14 WHERE `id`=40;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='KU';
=63
SELECT `id` FROM `airlines` WHERE `code`='KU';
=63
SELECT `id` FROM `models` WHERE `icao`='A306';
=4
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='departure' AND `airline`=63 AND `code`='172' AND `scheduled`='0000-00-01 14:30'
=41,
UPDATE `flights` SET `aircraft`=NULL, `model`=4 WHERE `id`=41;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='AC';
=4
SELECT `id` FROM `airlines` WHERE `code`='AC';
=4
SELECT `id` FROM `models` WHERE `icao`='A333';
=14
SELECT `id` FROM `aircrafts` WHERE `reg`='C-GHKW';
=6
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='departure' AND `airline`=4 AND `code`='877' AND `scheduled`='0000-00-01 17:00'
=42,
UPDATE `flights` SET `aircraft`=6, `model`=14 WHERE `id`=42;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='TP';
=113
SELECT `id` FROM `airlines` WHERE `code`='TP';
=113
SELECT `id` FROM `models` WHERE `icao`='A320';
=9
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='departure' AND `airline`=113 AND `code`='579' AND `scheduled`='0000-00-01 19:10'
=44,
UPDATE `flights` SET `aircraft`=NULL, `model`=9 WHERE `id`=44;
=OK

/************************************/

SELECT `id` FROM `airlines` WHERE `code`='SA';
=99
SELECT `id` FROM `airlines` WHERE `code`='SA';
=99
SELECT `id` FROM `models` WHERE `icao`='A346';
=19
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='departure' AND `airline`=99 AND `code`='261' AND `scheduled`='0000-00-01 20:45'
=46,
UPDATE `flights` SET `aircraft`=NULL, `model`=19 WHERE `id`=46;
=OK

/************************************/


/************************************/

SELECT `id` FROM `airlines` WHERE `code`='SQ';
=105
SELECT `id` FROM `airlines` WHERE `code`='SQ';
=105
SELECT `id` FROM `models` WHERE `icao`='B77W';
=68
SELECT `id`, `aircraft` FROM `flights` WHERE `direction`='departure' AND `airline`=105 AND `code`='325' AND `scheduled`='0000-00-01 21:55'
=47,
UPDATE `flights` SET `aircraft`=NULL, `model`=68 WHERE `id`=47;
=OK

/************************************/

---------------------------
12 Flüge gefunden.
    Dauer: 0.000s

===========================

SELECT `flights`.`id`, `airlines`.`code`, `flights`.`code`, `flights`.`scheduled`, `flights`.`direction` FROM `flights` LEFT JOIN `airlines` ON `flights`.`airline` = `airlines`.`id` WHERE `airport` IS NULL AND (`scheduled` >= '0000-00-01 05:00:00' OR `expected` >= '0000-00-01 05:00:00' OR (TIME_TO_SEC(TIMEDIFF('0000-00-01 05:00:00', `scheduled`)) / 60 / 60) < 2) ORDER BY `scheduled`;

INSERT INTO `watchlist-notifications`(`flight`, `watch`)  SELECT `flights`.`id`, `watchlist`.`id` FROM `watchlist` INNER JOIN `aircrafts` ON `aircrafts`.`reg` LIKE REPLACE(REPLACE(`watchlist`.`reg`, '*', '%'), '?', '_') INNER JOIN (SELECT `id`, `direction`, IFNULL(`expected`, `scheduled`) AS `expected`, `aircraft` FROM `flights` WHERE `aircraft` IS NOT NULL) AS `flights` ON `aircrafts`.`id` = `flights`.`aircraft` LEFT JOIN `watchlist-notifications` ON `watchlist-notifications`.`flight` = `flights`.`id` WHERE `watchlist`.`notify` = TRUE AND `watchlist-notifications`.`flight` IS NULL AND 'arrival' = `flights`.`direction` AND `expected` > '0000-00-01 05:00:00' FOR UPDATE
SELECT `watchlist-notifications`.`id`, CONCAT('+', DATEDIFF(IFNULL(`flights`.`expected`, `flights`.`scheduled`), '0000-00-01 05:00:00'), ' ', TIME_FORMAT(IFNULL(`flights`.`expected`, `flights`.`scheduled`), '%H:%i')) AS `expected`, CONCAT(`airlines`.`code`, `flights`.`code`) AS `flight`, `watchlist`.`id` AS `watch`, `aircrafts`.`reg` AS `reg`, `watchlist`.`comment` AS `comment`, `users`.`name` AS `user`, `users`.`email` AS `email` FROM `watchlist-notifications` LEFT JOIN `watchlist` ON `watchlist-notifications`.`watch` = `watchlist`.`id` LEFT JOIN `flights` ON `watchlist-notifications`.`flight` = `flights`.`id` LEFT JOIN `airlines` ON `flights`.`airline` = `airlines`.`id` LEFT JOIN `aircrafts` ON `flights`.`aircraft` = `aircrafts`.`id` LEFT JOIN `users` ON `watchlist`.`user` = `users`.`id` WHERE IFNULL(`flights`.`expected`, `flights`.`scheduled`) > '0000-00-01 05:00:00' AND `notified` IS NULL AND TIME('0000-00-01 05:00:00') BETWEEN `users`.`notification-from` AND `users`.`notification-until` ORDER BY `email` ASC, `expected` ASC
DELETE `watchlist-notifications` FROM `watchlist-notifications` INNER JOIN `flights` ON `flights`.`id`=`watchlist-notifications`.`flight` WHERE (DATEDIFF('0000-00-01 05:00:00', IFNULL(`flights`.`expected`, `flights`.`scheduled`)) > 1)


=== fin. ===
</pre>
</body>
</html>
