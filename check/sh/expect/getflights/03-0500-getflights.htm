<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>getflights &middot; debug output</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="author" content="Tobias Kühne">
</head>
<body>
<pre>
arrival
http://localhost/.../flugplan/airportcity?type=arrival&typ=p&context=0&sprache=de&items=3&init=true&page=1
---------------------------
0 Flüge gefunden.
    Dauer: 0.000s

===========================

departure
http://localhost/.../flugplan/airportcity?type=departure&typ=p&context=0&sprache=de&items=3&init=true&page=1
---------------------------
0 Flüge gefunden.
    Dauer: 0.000s

===========================

SELECT `flights`.`id`, `airlines`.`code`, `flights`.`code`, `flights`.`scheduled`, `flights`.`direction` FROM `flights` LEFT JOIN `airlines` ON `flights`.`airline` = `airlines`.`id` WHERE `airport` IS NULL AND (`scheduled` >= '0000-00-03 05:00:00' OR `expected` >= '0000-00-03 05:00:00' OR (TIME_TO_SEC(TIMEDIFF('0000-00-03 05:00:00', `scheduled`)) / 60 / 60) < 2) ORDER BY `scheduled`;

INSERT INTO `watchlist-notifications`(`watch`, `flight`)  SELECT `watchlist`.`id`, `flights`.`id` FROM `watchlist` INNER JOIN `aircrafts` ON `aircrafts`.`reg` LIKE REPLACE(REPLACE(`watchlist`.`reg`, '*', '%'), '?', '_') INNER JOIN (SELECT `id`, `direction`, IFNULL(`expected`, `scheduled`) AS `expected`, `aircraft` FROM `flights` WHERE `aircraft` IS NOT NULL) AS `flights` ON `aircrafts`.`id` = `flights`.`aircraft` LEFT JOIN `watchlist-notifications` ON `watchlist-notifications`.`flight` = `flights`.`id` WHERE `watchlist`.`notify` = TRUE AND `watchlist-notifications`.`flight` IS NULL AND 'arrival' = `flights`.`direction` AND `expected` > '0000-00-03 05:00:00'
SELECT `watchlist-notifications`.`id`, CONCAT('+', DATEDIFF(IFNULL(`flights`.`expected`, `flights`.`scheduled`), '0000-00-03 05:00:00'), ' ', TIME_FORMAT(IFNULL(`flights`.`expected`, `flights`.`scheduled`), '%H:%i')) AS `expected`, CONCAT(`airlines`.`code`, `flights`.`code`) AS `flight`, `watchlist`.`id` AS `watch`, `aircrafts`.`reg` AS `reg`, `watchlist`.`comment` AS `comment`, `users`.`name` AS `user`, `users`.`email` AS `email` FROM `watchlist-notifications` LEFT JOIN `watchlist` ON `watchlist-notifications`.`watch` = `watchlist`.`id` LEFT JOIN `flights` ON `watchlist-notifications`.`flight` = `flights`.`id` LEFT JOIN `airlines` ON `flights`.`airline` = `airlines`.`id` LEFT JOIN `aircrafts` ON `flights`.`aircraft` = `aircrafts`.`id` LEFT JOIN `users` ON `watchlist`.`user` = `users`.`id` WHERE IFNULL(`flights`.`expected`, `flights`.`scheduled`) > '0000-00-03 05:00:00' AND `notified` IS NULL AND TIME('0000-00-03 05:00:00') BETWEEN `users`.`notification-from` AND `users`.`notification-until` ORDER BY `email` ASC, `expected` ASC
DELETE `watchlist-notifications` FROM `watchlist-notifications` INNER JOIN `flights` ON `flights`.`id`=`watchlist-notifications`.`flight` WHERE (DATEDIFF('0000-00-03 05:00:00', IFNULL(`flights`.`expected`, `flights`.`scheduled`)) > 1)


=== fin. ===
</pre>
</body>
</html>
